# 專案範例

接下來我們以一個商品紅配綠的活動範例，來瞭解 TDD 是如何實現的。為了便於理解，範例的設計將會簡化，也許會與業界實際案例有所差異。

## 需求規格

先來看看需求規格：

1. 當購物車加入一個紅標商品時，必須再加入一個綠標商品才可結帳。

1. 一個紅標商品，必須只對應一個綠標商品，不可有兩個以上的紅標商品對應一個綠標商品，或是一個紅標商品對應兩個以上綠標商品的狀況。

1. 當加入紅標商品和綠標商品時，購物車顯示總價應為所有商品價格總合的 75 折。

1. 最少要有一個紅標商品和一個綠標商品才可結帳。

1. 因為活動是有時限的，所以計算方式將在活動結束後還原成一般不打折扣的計算方式。

## 範例情境

接著我們要設定範例情境：

* 假定有四項商品，分別是：

 * 紅標商品 1 - $200
 * 紅標商品 2 - $160
 * 綠標商品 1 - $80
 * 綠標商品 2 - $100

* 一個購物車，其功能有：

 * 加入商品
 * 計算總價
 * 結帳

## 使用案例

1. 購物車加入一個紅標商品 1 後結帳，出現「無法結帳」的錯誤訊息。

1. 購物車加入一個紅標商品 1 及綠標商品 1 ，總金額應為 $210 。

1. 購物車加入一個紅標商品 2 及綠標商品 2 ，總金額應為 $195 。

1. 購物車加入一個紅標商品 1 及綠標商品 2 ，總金額應為 $225 。

1. 購物車加入一個紅標商品 1 、紅標商品 2 及綠標商品 1 ，出現「商品配對錯誤」的錯誤訊息。

1. 購物車加入一個紅標商品 1 、綠標商品 1 及綠標商品 2 ，出現「商品配對錯誤」的錯誤訊息。

1. 活動期限為今年 10/1 ~ 10/31 ，活動開始前與活動結束後，總價皆不打折。

## 架構分析

TDD 並不是一開始就要撰寫測試，而是先設計出基本的程式架構，再搭配使用案例來撰寫測試，進而完成程式。

所以我們先進行初步的分析：

1. 角色有三個：購物車、商品、活動。

1. 商品包含品名、價格、活動標籤。

1. 購物車有加入商品、結帳等功能。

1. 活動有期限、包含驗證是否符合活動條件、計算折扣等功能。

## 設計

以下我們直接設計將要開發的類別：

* Cart - 購物車
 * __construct - 建構子 (接受一個活動物件)
 * addProduct - 加入購物車 (接受一個商品物件)
 * checkout - 結帳 (計算總價，成功回傳 `true` 、失敗回傳錯誤訊息)

* Product - 商品
 * __construct - 建構子 (設定商品資訊)
 * getTag - 取得活動標籤 (`R` 為紅標， `G` 為綠標)
 * getName - 取得名稱
 * getPrice - 取得單價

* Event - 促銷活動
 * __construct - 建構子 (設定期限)
 * isValid - 檢查商品 (確認是否符合活動條件)
 * calculate - 計算折扣 (從購物車中取得商品後計算金額)

## 練習

* 試著用圖形來表示整個專案的抽象架構圖，並說明給身邊的同學瞭解。

* 想想看這樣的設計規格可能會有什麼問題？